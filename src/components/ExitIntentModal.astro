---
// Exit intent modal
---

<div id="exit-intent-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-brand-navy/60 p-4 backdrop-blur-sm">
  <div class="surface relative w-full max-w-md p-8">
    <!-- Close button -->
    <button
      id="close-exit-modal"
      class="absolute right-4 top-4 text-neutral-400 transition-colors duration-200 hover:text-brand-navy"
      aria-label="Close modal"
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>

    <!-- Content -->
    <div class="text-center">
      <div class="mx-auto mb-6 flex h-16 w-16 items-center justify-center rounded-full bg-brand-sky">
        <svg class="h-8 w-8 text-brand-navy" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
      </div>

      <h3 class="card-title mb-3 text-brand-navy">
        Don't Leave Without Your Free Checklist!
      </h3>

      <p class="text-body-sm text-neutral-500">
        Get our comprehensive Month-End Close Checklist (Texas Edition) with 25+ steps to ensure your books are audit-ready and tax-prepared.
      </p>

      <!-- Lead capture form -->
      <form id="exit-modal-form" class="mt-6 space-y-4">
        <div>
          <label for="exit-email" class="sr-only">Email address</label>
          <input
            type="email"
            id="exit-email"
            name="email"
            placeholder="Enter your email address"
            class="w-full rounded-lg border border-neutral-200 px-4 py-3 text-sm text-brand-navy focus:border-brand-gold/60 focus:outline-none focus:ring-2 focus:ring-brand-gold"
            required
          />
        </div>

        <button
          type="submit"
          class="btn btn-primary w-full justify-center"
        >
          Get My Free Checklist
        </button>
      </form>

      <p class="mt-4 text-xs text-neutral-400">
        No spam, unsubscribe at any time. We respect your privacy.
      </p>
    </div>
  </div>
</div>

<script>
  // Declare gtag function for TypeScript
  declare function gtag(...args: any[]): void;

  const modal = document.getElementById('exit-intent-modal');
  const closeBtn = document.getElementById('close-exit-modal');
  const form = document.getElementById('exit-modal-form');

  let hasShown = false;

  // Exit intent detection
  document.addEventListener('mouseout', (e) => {
    if (!hasShown && e.clientY < 0 && e.relatedTarget === null) {
      modal?.classList.remove('hidden');
      hasShown = true;
    }
  });

  // Close modal
  closeBtn?.addEventListener('click', () => {
    modal?.classList.add('hidden');
  });

  // Click outside to close
  modal?.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.classList.add('hidden');
    }
  });

  // Form submission
  form?.addEventListener('submit', (e) => {
    e.preventDefault();
    const email = (document.getElementById('exit-email') as HTMLInputElement)?.value;

    // Track conversion
    if (typeof gtag !== 'undefined') {
      gtag('event', 'download_checklist', {
        event_category: 'engagement',
        event_label: 'exit_intent_modal'
      });
    }

    // Here you would send the email to your CRM/lead system
    alert(`Thank you! Your checklist will be sent to ${email}`);
    modal?.classList.add('hidden');
  });
</script>