---
// Blog Post Template Component
// Comprehensive template for blog posts with structured data, A/B testing, and conversion optimization

export interface Props {
  title: string;
  description: string;
  author: string;
  publishedTime: string;
  modifiedTime?: string;
  readTime: number;
  tags: string[];
  slug: string;
  ogImage?: string;
  showTOC?: boolean;
  ctaVariant?: 'assessment' | 'consultation';
}

const {
  title,
  description,
  author,
  publishedTime,
  modifiedTime,
  readTime,
  tags,
  slug,
  ogImage = '/og-default.jpg',
  showTOC = true,
  ctaVariant = 'assessment'
} = Astro.props;

// Generate table of contents from headings (will be populated by script)
const tocItems: Array<{ id: string; text: string; level: number }> = [];

// CTA configurations
const ctaConfigs = {
  assessment: {
    title: "Get Your Free Bookkeeping Assessment",
    subtitle: "Discover how much time and money you're losing to bookkeeping errors.",
    buttonText: "Get My Free Assessment",
    buttonLink: "/contact?source=blog-assessment",
    benefits: [
      "30-minute personalized review",
      "Custom ROI calculation",
      "No-obligation recommendations",
      "Texas-specific insights"
    ]
  },
  consultation: {
    title: "Schedule Your Free Consultation",
    subtitle: "Talk to a Texas-based bookkeeping expert about your specific situation.",
    buttonText: "Book Free Consultation",
    buttonLink: "/contact?source=blog-consultation",
    benefits: [
      "45-minute strategy session",
      "Current system analysis",
      "Custom pricing quote",
      "Implementation timeline"
    ]
  }
};

const ctaConfig = ctaConfigs[ctaVariant];

// Related posts (placeholder - would be populated based on tags/similar content)
const relatedPosts = [
  {
    title: "How Much Should Bookkeeping Cost? Real Math for Texas Businesses",
    slug: "bookkeeping-cost-real-math-texas",
    readTime: 8,
    publishedTime: "2025-09-20"
  },
  {
    title: "Cash vs. Accrual: Which Saves You More on Taxes?",
    slug: "cash-vs-accrual-tax-savings",
    readTime: 6,
    publishedTime: "2025-09-18"
  },
  {
    title: "The Bookkeeping Tech Stack We Trust (and Why)",
    slug: "bookkeeping-tech-stack-trust",
    readTime: 10,
    publishedTime: "2025-09-15"
  }
];
---

<article class="blog-post">
  <!-- Article Header -->
  <header class="blog-header">
    <div class="container max-w-4xl">
      <!-- Breadcrumbs -->
      <nav class="breadcrumbs" aria-label="Breadcrumb">
        <ol class="flex items-center space-x-2 text-sm text-neutral-500">
          <li><a href="/" class="hover:text-brand-navy">Home</a></li>
          <li><span class="text-neutral-300">/</span></li>
          <li><a href="/resources" class="hover:text-brand-navy">Resources</a></li>
          <li><span class="text-neutral-300">/</span></li>
          <li><span class="text-neutral-700" aria-current="page">{title}</span></li>
        </ol>
      </nav>

      <!-- Tags -->
      <div class="tags mt-6">
        {tags.map(tag => (
          <span class="inline-block bg-brand-sky/10 text-brand-navy px-3 py-1 rounded-full text-sm font-medium mr-2 mb-2">
            {tag}
          </span>
        ))}
      </div>

      <!-- Title -->
      <h1 class="blog-title">{title}</h1>

      <!-- Meta Information -->
      <div class="blog-meta">
        <div class="author-info">
          <div class="author-avatar">
            <img src="/avatars/default.jpg" alt={author} class="w-10 h-10 rounded-full" />
          </div>
          <div class="author-details">
            <span class="author-name">{author}</span>
            <span class="meta-separator">•</span>
            <time datetime={publishedTime} class="publish-date">
              {new Date(publishedTime).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
              })}
            </time>
            <span class="meta-separator">•</span>
            <span class="read-time">{readTime} min read</span>
          </div>
        </div>
      </div>

      <!-- Social Share -->
      <div class="social-share">
        <span class="share-label">Share this article:</span>
        <div class="share-buttons">
          <button class="share-btn linkedin" data-platform="linkedin" aria-label="Share on LinkedIn">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
          </button>
          <button class="share-btn twitter" data-platform="twitter" aria-label="Share on Twitter">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>
          </button>
          <button class="share-btn facebook" data-platform="facebook" aria-label="Share on Facebook">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Table of Contents -->
  {showTOC && (
    <aside class="toc-sidebar" id="toc-sidebar">
      <div class="toc-content">
        <h3 class="toc-title">Table of Contents</h3>
        <nav class="toc-nav" aria-label="Table of contents">
          <ol class="toc-list">
            {tocItems.map(item => (
              <li class={`toc-item toc-level-${item.level}`}>
                <a href={`#${item.id}`} class="toc-link">{item.text}</a>
              </li>
            ))}
          </ol>
        </nav>
      </div>
    </aside>
  )}

  <!-- Article Content -->
  <div class="blog-content">
    <div class="container max-w-4xl">
      <div class="content-wrapper">
        <slot />
      </div>
    </div>
  </div>

  <!-- Inline CTA -->
  <section class="inline-cta">
    <div class="container max-w-4xl">
      <div class="cta-card">
        <div class="cta-content">
          <h2 class="cta-title">{ctaConfig.title}</h2>
          <p class="cta-subtitle">{ctaConfig.subtitle}</p>

          <ul class="cta-benefits">
            {ctaConfig.benefits.map(benefit => (
              <li class="cta-benefit">
                <svg class="benefit-icon" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                </svg>
                {benefit}
              </li>
            ))}
          </ul>

          <div class="cta-actions">
            <a href={ctaConfig.buttonLink} class="cta-button">
              {ctaConfig.buttonText}
              <svg class="button-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
              </svg>
            </a>
            <span class="cta-guarantee">No spam • Unsubscribe anytime</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Author Bio -->
  <section class="author-bio">
    <div class="container max-w-4xl">
      <div class="bio-card">
        <div class="bio-avatar">
          <img src="/avatars/default.jpg" alt={author} class="avatar-image" />
        </div>
        <div class="bio-content">
          <h3 class="bio-name">{author}</h3>
          <p class="bio-title">Bookkeeping Expert & Modern Ledger Co-Founder</p>
          <p class="bio-description">
            With over 15 years of experience helping Texas businesses with their financial management,
            {author.split(' ')[0]} specializes in streamlining bookkeeping processes and implementing
            technology solutions that save time and reduce errors.
          </p>
          <div class="bio-links">
            <a href="/about" class="bio-link">About Modern Ledger</a>
            <a href="/contact" class="bio-link">Get in Touch</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Related Posts -->
  <section class="related-posts">
    <div class="container max-w-6xl">
      <h2 class="section-title">Related Articles</h2>
      <div class="posts-grid">
        {relatedPosts.map(post => (
          <article class="related-post">
            <div class="post-content">
              <h3 class="post-title">
                <a href={`/resources/${post.slug}`}>{post.title}</a>
              </h3>
              <div class="post-meta">
                <time datetime={post.publishedTime} class="post-date">
                  {new Date(post.publishedTime).toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric'
                  })}
                </time>
                <span class="post-read-time">{post.readTime} min read</span>
              </div>
            </div>
          </article>
        ))}
      </div>
    </div>
  </section>
</article>

<!-- Structured Data: Article -->
<script type="application/ld+json" set:html={
  JSON.stringify({
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": title,
    "description": description,
    "image": [`${Astro.site}${ogImage}`],
    "datePublished": publishedTime,
    "dateModified": modifiedTime || publishedTime,
    "author": {
      "@type": "Person",
      "name": author,
      "jobTitle": "Bookkeeping Expert & Co-Founder",
      "worksFor": {
        "@type": "Organization",
        "name": "Modern Ledger"
      }
    },
    "publisher": {
      "@type": "Organization",
      "name": "Modern Ledger",
      "logo": {
        "@type": "ImageObject",
        "url": `${Astro.site}/logos/modern-ledger-logo.png`
      }
    },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": `${Astro.site}/resources/${slug}`
    },
    "articleSection": tags[0] || "Bookkeeping",
    "keywords": tags.join(", "),
    "wordCount": Math.floor(description.length / 5), // Rough estimate
    "timeRequired": `PT${readTime}M`,
    "about": tags.map(tag => ({
      "@type": "Thing",
      "name": tag
    }))
  })
}></script>

<style>
  .blog-post {
    @apply bg-white;
  }

  .blog-header {
    @apply bg-gradient-to-br from-neutral-50 to-white py-12 md:py-20;
  }

  .breadcrumbs {
    @apply mb-6;
  }

  .tags {
    @apply mb-4;
  }

  .blog-title {
    @apply text-3xl md:text-4xl lg:text-5xl font-bold text-brand-navy mb-6 leading-tight;
  }

  .blog-meta {
    @apply flex items-center gap-4 mb-8;
  }

  .author-info {
    @apply flex items-center gap-3;
  }

  .author-avatar img {
    @apply border-2 border-white shadow-sm;
  }

  .author-details {
    @apply flex items-center gap-2 text-sm text-neutral-600;
  }

  .author-name {
    @apply font-semibold text-brand-navy;
  }

  .meta-separator {
    @apply text-neutral-400;
  }

  .social-share {
    @apply flex items-center gap-4 pt-6 border-t border-neutral-200;
  }

  .share-label {
    @apply text-sm font-medium text-neutral-700;
  }

  .share-buttons {
    @apply flex gap-2;
  }

  .share-btn {
    @apply p-2 rounded-full bg-neutral-100 hover:bg-brand-sky/20 text-neutral-600 hover:text-brand-navy transition-colors;
  }

  .toc-sidebar {
    @apply fixed top-24 right-4 w-64 bg-white border border-neutral-200 rounded-lg p-4 shadow-lg z-10 hidden xl:block;
  }

  .toc-title {
    @apply text-lg font-semibold text-brand-navy mb-4;
  }

  .toc-list {
    @apply space-y-2;
  }

  .toc-link {
    @apply text-sm text-neutral-600 hover:text-brand-navy transition-colors block py-1;
  }

  .toc-level-2 {
    @apply ml-4;
  }

  .toc-level-3 {
    @apply ml-8;
  }

  .blog-content {
    @apply py-12;
  }

  .content-wrapper {
    @apply prose prose-lg max-w-none;
  }

  .content-wrapper :global(h2) {
    @apply text-2xl font-bold text-brand-navy mt-12 mb-6;
  }

  .content-wrapper :global(h3) {
    @apply text-xl font-semibold text-brand-navy mt-8 mb-4;
  }

  .content-wrapper :global(p) {
    @apply mb-6 text-neutral-700 leading-relaxed;
  }

  .content-wrapper :global(ul) {
    @apply mb-6 pl-6;
  }

  .content-wrapper :global(li) {
    @apply mb-2 text-neutral-700;
  }

  .content-wrapper :global(blockquote) {
    @apply border-l-4 border-brand-gold pl-6 italic text-neutral-600 my-8;
  }

  .inline-cta {
    @apply bg-gradient-to-r from-brand-sky/5 to-brand-gold/5 py-16 my-12;
  }

  .cta-card {
    @apply bg-white rounded-2xl shadow-lg border border-neutral-200 p-8 md:p-12;
  }

  .cta-title {
    @apply text-2xl md:text-3xl font-bold text-brand-navy mb-4;
  }

  .cta-subtitle {
    @apply text-lg text-neutral-600 mb-6;
  }

  .cta-benefits {
    @apply mb-8;
  }

  .cta-benefit {
    @apply flex items-center gap-3 text-neutral-700 mb-3;
  }

  .benefit-icon {
    @apply w-5 h-5 text-brand-gold flex-shrink-0;
  }

  .cta-actions {
    @apply flex flex-col sm:flex-row items-start sm:items-center gap-4;
  }

  .cta-button {
    @apply inline-flex items-center gap-2 bg-brand-navy text-white px-8 py-4 rounded-lg font-semibold hover:bg-brand-navy/90 transition-colors;
  }

  .button-icon {
    @apply w-5 h-5;
  }

  .cta-guarantee {
    @apply text-sm text-neutral-500;
  }

  .author-bio {
    @apply bg-neutral-50 py-12;
  }

  .bio-card {
    @apply bg-white rounded-xl shadow-sm border border-neutral-200 p-6 md:p-8 flex gap-6;
  }

  .bio-avatar {
    @apply flex-shrink-0;
  }

  .avatar-image {
    @apply w-16 h-16 rounded-full border-4 border-white shadow-sm;
  }

  .bio-content {
    @apply flex-1;
  }

  .bio-name {
    @apply text-xl font-bold text-brand-navy mb-1;
  }

  .bio-title {
    @apply text-neutral-600 mb-4;
  }

  .bio-description {
    @apply text-neutral-700 mb-4;
  }

  .bio-links {
    @apply flex gap-4;
  }

  .bio-link {
    @apply text-brand-navy hover:text-brand-gold font-medium transition-colors;
  }

  .related-posts {
    @apply bg-white py-16;
  }

  .section-title {
    @apply text-3xl font-bold text-brand-navy text-center mb-12;
  }

  .posts-grid {
    @apply grid md:grid-cols-3 gap-8;
  }

  .related-post {
    @apply bg-neutral-50 rounded-lg p-6 hover:bg-neutral-100 transition-colors;
  }

  .post-title {
    @apply text-lg font-semibold text-brand-navy mb-3 leading-tight;
  }

  .post-title a {
    @apply hover:text-brand-gold transition-colors;
  }

  .post-meta {
    @apply flex items-center gap-4 text-sm text-neutral-600;
  }
</style>

<script>
  // Table of Contents Generation
  function generateTOC() {
    const headings = document.querySelectorAll('h2, h3');
    const tocList = document.querySelector('.toc-list');

    if (!tocList) return;

    headings.forEach((heading, index) => {
      const id = `heading-${index}`;
      heading.id = id;

      const level = parseInt(heading.tagName.charAt(1));
      const text = heading.textContent || '';

      const li = document.createElement('li');
      li.className = `toc-item toc-level-${level - 1}`;

      const a = document.createElement('a');
      a.href = `#${id}`;
      a.className = 'toc-link';
      a.textContent = text;

      li.appendChild(a);
      tocList.appendChild(li);
    });
  }

  // Social Sharing
  function setupSocialSharing() {
    const shareButtons = document.querySelectorAll('.share-btn');

    shareButtons.forEach(button => {
      button.addEventListener('click', () => {
        const platform = button.getAttribute('data-platform');
        const url = encodeURIComponent(window.location.href);
        const title = encodeURIComponent(document.title);

        let shareUrl = '';

        switch (platform) {
          case 'linkedin':
            shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${url}`;
            break;
          case 'twitter':
            shareUrl = `https://twitter.com/intent/tweet?url=${url}&text=${title}`;
            break;
          case 'facebook':
            shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
            break;
        }

        if (shareUrl) {
          window.open(shareUrl, '_blank', 'width=600,height=400');
        }
      });
    });
  }

  // Track engagement
  function trackEngagement() {
    // Track scroll depth
    let maxScroll = 0;
    const trackScroll = () => {
      const scrollPercent = Math.round((window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100);
      if (scrollPercent > maxScroll) {
        maxScroll = scrollPercent;
      }
    };

    window.addEventListener('scroll', trackScroll);

    // Track time on page
    const startTime = Date.now();
    window.addEventListener('beforeunload', () => {
      const timeSpent = Math.round((Date.now() - startTime) / 1000);

      if (typeof window !== 'undefined' && (window as any).gtag) {
        (window as any).gtag('event', 'blog_engagement', {
          scroll_depth: maxScroll,
          time_spent: timeSpent,
          page_path: window.location.pathname
        });
      }
    });
  }

  // Initialize everything
  document.addEventListener('DOMContentLoaded', () => {
    generateTOC();
    setupSocialSharing();
    trackEngagement();
  });
</script>